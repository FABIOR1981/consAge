<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Reservas</title>
    <link rel="stylesheet" href="css/comunes.css">
    <link rel="stylesheet" href="css/informe.css">
</head>
<body>
    <div class="informe-container">
        <h2 class="informe-titulo">Informe de Reservas</h2>
        <form id="form-informe" class="informe-form">
                        <div class="search-row">
                            <label for="combo-usuario2" class="search-label">Usuario (Avanzado):</label>
                            <input type="text" id="combo-usuario2" class="search-input" placeholder="Buscar usuario por nombre o apellido" autocomplete="off">
                            <div id="autocomplete-lista-usuario2" class="autocomplete-lista"></div>
                            <span class="search-note">(autocompletado avanzado por nombre/apellido)</span>
                        </div>
            <label>Fecha inicio:
                <input type="date" name="fechaInicio" required>
            </label>
            <label>Fecha fin:
                <input type="date" name="fechaFin" required>
            </label>
            <label>Consultorio:
                <select name="consultorio" id="combo-consultorio">
                    <option value="0">Todos</option>
                </select>
            </label>
            <div class="search-row">
                <label for="input-usuario" class="search-label">Usuario:</label>
                <input type="text" name="usuario" id="input-usuario" class="search-input" placeholder="Email o nombre" list="datalist-usuarios" autocomplete="off">
                <datalist id="datalist-usuarios"></datalist>
                <span class="search-note">(usuario, nombre u apellido)</span>
            </div>
            <button type="submit">Buscar</button>
        </form>
        <div id="total-horas-informe"></div>
            <div class="table-container">
                <table class="table">
                    <tr><td colspan="5">Complete los filtros y presione Buscar</td></tr>
                </table>
            </div>
    </div>
    <script type="module" src="js/informe.js"></script>
                <script type="module">
                    // Autocompletado avanzado para ComboUsuario2
                    let usuariosCache2 = [];
                    async function cargarUsuariosCombo2() {
                        if (!usuariosCache2.length) {
                            const resp = await fetch('/data/usuarios.json');
                            const data = await resp.json();
                            if (Array.isArray(data)) usuariosCache2 = data;
                        }
                    }
                    function filtrarYMostrarCombo2() {
                        const input = document.getElementById('combo-usuario2');
                        const lista = document.getElementById('autocomplete-lista-usuario2');
                        const val = input.value.trim().toLowerCase();
                        lista.innerHTML = '';
                        if (!val) { lista.style.display = 'none'; return; }
                        const filtrados = usuariosCache2.filter(u => u.nombre && u.nombre.toLowerCase().includes(val));
                        filtrados.forEach(u => {
                            const item = document.createElement('div');
                            item.className = 'autocomplete-item';
                            item.textContent = u.nombre;
                            item.addEventListener('mousedown', function(e) {
                                input.value = u.nombre;
                                lista.innerHTML = '';
                                lista.style.display = 'none';
                            });
                            lista.appendChild(item);
                        });
                        lista.style.display = filtrados.length ? 'block' : 'none';
                    }
                    window.addEventListener('DOMContentLoaded', async () => {
                        await cargarUsuariosCombo2();
                        const input = document.getElementById('combo-usuario2');
                        input.addEventListener('input', filtrarYMostrarCombo2);
                        input.addEventListener('blur', function() {
                            setTimeout(() => {
                                document.getElementById('autocomplete-lista-usuario2').innerHTML = '';
                                document.getElementById('autocomplete-lista-usuario2').style.display = 'none';
                            }, 150);
                        });
                    });
                </script>
        <script type="module">
            import { cargarUsuariosParaAutocomplete } from './js/autocomplete_usuarios.js';
            window.addEventListener('DOMContentLoaded', () => {
                cargarUsuariosParaAutocomplete('input-usuario', 'datalist-usuarios');
            });
        </script>
<style>
.search-row {
    position: relative;
}
.autocomplete-lista {
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    background: #fff;
    border: 1px solid #ccc;
    z-index: 1000;
    max-height: 180px;
    overflow-y: auto;
    min-width: 180px;
    width: 100%;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
.autocomplete-item {
    padding: 8px 12px;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.autocomplete-item:hover {
    background: #e6f0fa;
}
</style>
</style>
</body>
</html>
<!-- Última revisión: formulario de búsqueda con un solo input y radio buttons alineados. -->
